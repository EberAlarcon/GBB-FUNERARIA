--CREAR PROCEDIMIENTO ALMACENADO--
CREATE OR REPLACE FUNCTION PUBLIC."GANANCIAS" (NOMBRE_ESPACIO TEXT)
RETURNS TABLE (SERVICIOS TEXT)
AS $$
DECLARE 
INGRESO RECORD;
BEGIN 
FOR INGRESO IN 
SELECT SALA_VELATORIO.NOMBRE_ESPACIO ||' '|| SUM (SERVICIO.COSTO_SERVICIO) AS NOMBRE
FROM
PUBLIC.SERVICIO,
PUBLIC.SALA_VELATORIO
WHERE 
SERVICIO.ID_ESPACIO = SALA_VELATORIO.ID_ESPACIO AND
SALA_VELATORIO.NOMBRE_ESPACIO =$1
GROUP BY SALA_VELATORIO.NOMBRE_ESPACIO
LOOP SERVICIOS := INGRESO.NOMBRE;
RETURN NEXT ;
END LOOP;
RETURN;
END; $$
LANGUAGE 'plpgsql'


--SELECCIONAR--
select * from "GANANCIAS" ('SALA PEQUEÑA')
--SELECCIONAR--
select * from "GANANCIAS" ('SALA MEDIANA')
--SELECCIONAR--
select * from "GANANCIAS" ('SALA GRANDE')



--CREAR PROCEDIMIENTO ALMACENADO--
CREATE OR REPLACE FUNCTION PUBLIC."INGRESO" (ESPACIO TEXT)
RETURNS TABLE 
(SERVICIOS TEXT, NOMBRE TEXT, INGRESO decimal)
AS $BODY$
BEGIN 
RETURN QUERY 
SELECT 
SALA_VELATORIO.NOMBRE_ESPACIO,
SERVICIO.DESCRIPCION_SERVICIO,
SUM (SERVICIO.COSTO_SERVICIO) AS NOMBRE
FROM
SALA_VELATORIO
INNER JOIN SERVICIO ON SALA_VELATORIO.ID_ESPACIO=SERVICIO.ID_ESPACIO
WHERE 
SERVICIO.ID_ESPACIO = SALA_VELATORIO.ID_ESPACIO AND
SALA_VELATORIO.NOMBRE_ESPACIO = ESPACIO 
GROUP BY (SALA_VELATORIO.NOMBRE_ESPACIO, SERVICIO.DESCRIPCION_SERVICIO);
END; 
$BODY$
LANGUAGE 'plpgsql'

--SELECCIONAR--
select * from "INGRESO" ('SALA PEQUEÑA')
--SELECCIONAR--
select * from "INGRESO" ('SALA MEDIANA')
--SELECCIONAR--
select * from "INGRESO" ('SALA GRANDE')
