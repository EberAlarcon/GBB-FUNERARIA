DO
$$
DECLARE
TOTAL RECORD;
CUR_SERVICIO CURSOR FOR SELECT 
DESCRIPCION_SERVICIO,
COUNT (DIFUNTO.NOMBRE_DIFUNTO) CANTIDAD_DE_DIFUNTOS, 
SUM (SERVICIO.COSTO_SERVICIO) AS GANANCIAS_SERVICIOS
FROM DIFUNTO  
INNER JOIN FAMILIAR  ON DIFUNTO.ID_FAMLIAR=FAMILIAR.ID_FAMLIAR
INNER JOIN SERVICIO ON FAMILIAR.ID_FAMLIAR=SERVICIO.ID_FAMLIAR
GROUP BY  DESCRIPCION_SERVICIO;
BEGIN 
OPEN CUR_SERVICIO;
FETCH CUR_SERVICIO INTO TOTAL;
WHILE (FOUND)LOOP
raise NOTICE '
NOMBRE DEL SERVICIO->  %        CANTIDAD: %    GANANCIAS:  %
',
TOTAL.DESCRIPCION_SERVICIO, TOTAL.CANTIDAD_DE_DIFUNTOS, TOTAL.GANANCIAS_SERVICIOS;
FETCH CUR_SERVICIO INTO TOTAL;
END LOOP;
END
$$
LANGUAGE 'plpgsql'
